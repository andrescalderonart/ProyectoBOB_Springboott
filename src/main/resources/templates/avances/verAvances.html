<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <!-- Dynamic title based on edit/view mode -->
  <title th:text="${'Detalle de Avance ID#'+ avance.idAvance}"></title>

  <style>
    /* Style for each material row */
    .material-row {
        margin: 10px 0;
        padding: 5px;
        border: 1px solid #ddd;
    }

    /* Base styles for form elements */
    input, select, button {
        margin: 5px 0;
        display: block;
    }

    /* Style for remove buttons */
    .btn-remove {
        color: red;
        cursor: pointer;
        margin-left: 10px;
    }

    /* Base button styling */
    .btn {
        padding: 8px 16px;
        background-color: #4CAF50;
        color: white;
        border: none;
        cursor: pointer;
        margin: 10px 0;
    }

    /* Container for activities section */
    #actividadesContainer {
        margin: 20px 0;
    }

    table {
        border-collapse: collapse;
        width: 100%;
    }

    th, td {
        border: 1px solid #ddd;
        padding: 8px;
        text-align: left;
    }

    th {
        background-color: #f2f2f2;
    }
  </style>
</head>

<body>
<!-- heading -->
<h1 th:text="${'Detalle de Avance (ID: ' + avance.idAvance + ')'}"></h1>


  <!-- View mode display -->
  <div th:unless="${Editando}">
    <div th:if="${listActividades != null and !listActividades.empty}">
      <table>
        <thead>
        <tr>
          <th>ID Actividad</th>
          <th>Nombre</th>
          <th>Unidades</th>
          <th>Cantidad</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="actividad : ${listActividades}">
          <td th:text="${actividad.id_m}"></td>
          <td th:text="${actividad.nombre}"></td>
          <td th:text="${actividad.unidades}"></td>
        </tr>
        </tbody>
      </table>
    </div>
    <h2 th:each="presupuesto : ${presupuestos}"
        th:if="${presupuesto.id_obra == avance.idObra}"
        th:text="${'Obra: ' + presupuesto.obraName}"></h2>
  </div>
  </div>



</form>

<!-- View mode display when not editing -->
<div th:unless="${Editando}">
  <h2 th:text="${avance.idAvance}"></h2>
  <h2 th:each="presupuesto : ${presupuestos}"
      th:if="${presupuesto.id_obra == avance.idObra}"
      th:text="${'Obra: ' + presupuesto.obraName}"></h2>

  <h3>Avance reportado:</h3>
  <div>
    <table>
      <thead>
      <tr>
        <th>ID Material</th>
        <th>Nombre</th>
        <th>Unidades</th>
        <th>Cantidad</th>
      </tr>
      </thead>
      <tbody>
      <tr>
        <td th:text="${avance.idMatriz}"></td>
        <td th:each="item : ${matriz}"
            th:if="${avance.idMatriz == item.id_m}"
            th:text="${item.nombre}">
        </td>
        <td th:each="item : ${matriz}"
            th:if="${avance.idMatriz == item.id_m}"
            th:text="${item.unidades}">
        </td>
        <td th:text="${avance.cantidad}"></td>
      </tr>
      </tbody>
    </table>
  </div>

</div>

<br><br>

<!-- Back button -->
<a th:href="@{/avances/inicioAvances}" class="btn">Regresar</a>
<br><br>

<!-- JavaScript for dynamic form behavior -->
<script th:if="${Editando}">
  /**
   * Adds a new material row to the form
   */
  function addActivity() {
        const container = document.getElementById('actividadesContainer');

        // Create new row div
        const newRow = document.createElement('div');
        newRow.className = 'material-row';

        // Create the select dropdown
        const select = document.createElement('select');
        select.name = 'actividadIds';
        select.required = true;

        // Add default option
        const defaultOption = document.createElement('option');
        defaultOption.value = '';
        defaultOption.textContent = 'Seleccione...';
        select.appendChild(defaultOption);

        // Add options from Thymeleaf (this will be filled by the browser)
        const options = document.querySelectorAll('select[name="actividadIds"] option:not([value=""])');
        options.forEach(option => {
            const newOption = option.cloneNode(true);
            select.appendChild(newOption);
        });

        // Create quantity input
        const quantityInput = document.createElement('input');
        quantityInput.type = 'number';
        quantityInput.name = 'cantidades';
        quantityInput.step = '0.01';
        quantityInput.min = '0.01';
        quantityInput.placeholder = 'Cantidad';
        quantityInput.required = true;

        // Create remove button
        const removeBtn = document.createElement('span');
        removeBtn.className = 'btn-remove';
        removeBtn.textContent = 'âœ• Eliminar';
        removeBtn.onclick = function() { removeRow(this); };

        // Append all elements to the row
        newRow.appendChild(select);
        newRow.appendChild(quantityInput);
        newRow.appendChild(removeBtn);

        // Add the row to the container
        container.appendChild(newRow);
    }



    function removeActivity(activityId, element) {
               // Remove visual element
        element.parentElement.remove();

    }


  // Initialize the form when page loads
  document.addEventListener('DOMContentLoaded', function() {
      if (document.querySelectorAll('.material-row').length === 0) {
          addActivity();
      }
  });
</script>
</body>
</html>